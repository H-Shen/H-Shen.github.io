<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>Haohu Shen's ePortfolio</title><meta name="author" content="Haohu Shen"><link rel="shortcut icon" href="/img/favicon.png"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.0.0"><link rel="alternate" href="/atom.xml" title="Haohu Shen's ePortfolio" type="application/atom+xml">
</head><body><header id="page_header"><div class="header_wrap"><div id="blog_name"><a class="blog_title" id="site-name" href="/">Haohu Shen's ePortfolio</a></div><button class="menus_icon"><div class="navicon"></div></button><ul class="menus_items"><li class="menus_item"><a class="site-page" href="/about"> About</a></li><li class="menus_item"><a class="site-page" href="/blogs"> Blogs</a></li><li class="menus_item"><a class="site-page" href="/projects"> Projects</a></li><li class="menus_item"><a class="site-page" href="/notes"> Notes</a></li></ul></div></header><main id="page_main"><div class="side-card sticky"><div class="card-wrap" itemscope itemtype="http://schema.org/Person"><div class="author-avatar"><img class="avatar-img" src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/profile.png'" alt="avatar"></div><div class="author-discrip"><h3>Haohu Shen</h3><p class="author-bio">Premature optimization is the root of all evil.</p></div><div class="author-links"><button class="btn m-social-links">Links</button><ul class="social-icons"><li><a class="social-icon" href="https://github.com/H-Shen" target="_blank"><i class="fab fa-github" aria-hidden="true"></i></a></li><li><a class="social-icon" href="https://stackoverflow.com/users/6844098/haohu-shen" target="_blank"><i class="fab fa-stack-overflow" aria-hidden="true"></i></a></li><li><a class="social-icon" href="https://www.linkedin.com/notifications/?filter=all" target="_blank"><i class="fab fa-linkedin" aria-hidden="true"></i></a></li><li><a class="social-icon" href="mailto:haohu3991@gmail.com" target="_blank"><i class="fas fa-envelope" aria-hidden="true"></i></a></li></ul></div></div></div><div class="page" itemscope itemtype="http://schema.org/CreativeWork"><h2 class="page-title"></h2><article><h4 id="Docker-CLI"><a href="#Docker-CLI" class="headerlink" title="Docker CLI"></a>Docker CLI</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker <span class="comment"># 手动开启docker</span></span><br><span class="line">systemctl <span class="built_in">enable</span> docker <span class="comment"># 开机自启docker</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker version</span><br><span class="line">docker info <span class="comment"># 显示docker系统信息</span></span><br><span class="line">docker --<span class="built_in">help</span></span><br></pre></td></tr></table></figure>

<p>帮助文档 <a target="_blank" rel="noopener" href="https://docs.docker.com/reference/">https://docs.docker.com/reference/</a></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 镜像命令</span></span><br><span class="line">docker images</span><br><span class="line">docker images --format <span class="string">&quot;table &#123;&#123;.Repository&#125;&#125;\t&#123;&#123;.Tag&#125;&#125;\t&#123;&#123;.ID&#125;&#125;\t&#123;&#123;.CreatedAt&#125;&#125;\t&#123;&#123;.Size&#125;&#125;&quot;</span> <span class="comment"># 显示创建时间</span></span><br><span class="line">docker search --filter is-official=<span class="literal">true</span> --filter stars=3 busybox <span class="comment"># 搜索官方至少为3星busybox仓库</span></span><br><span class="line">docker pull XXXX <span class="comment"># 默认从docker hub拉包</span></span><br><span class="line">docker pull mysql:8.0 <span class="comment"># 指定版本下载</span></span><br><span class="line">docker rmi -f IMAGE <span class="comment"># 根据ID删除镜像</span></span><br><span class="line">docker rmi -f IMAGE_ID1 IMAGE_ID2 IMAGE_ID3 <span class="comment"># 删除多个镜像</span></span><br><span class="line">docker rmi -f $(docker images -a -q)</span><br></pre></td></tr></table></figure>

<h4 id="容器就是镜像的实例化"><a href="#容器就是镜像的实例化" class="headerlink" title="容器就是镜像的实例化"></a>容器就是镜像的实例化</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">docker pull centos:latest  <span class="comment"># 拉镜像</span></span><br><span class="line">docker run [可选参数] image <span class="comment"># 启动镜像</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 参数说明</span></span><br><span class="line">--name=<span class="string">&quot;container_name&quot;</span>  <span class="comment"># 给容器命名</span></span><br><span class="line">-d, --detach 	<span class="comment"># 后台运行容器</span></span><br><span class="line">-it	<span class="comment"># 使用交互方式运行</span></span><br><span class="line">-p  <span class="comment"># 指定容器端口</span></span><br><span class="line">		-p 主机端口:容器端口</span><br><span class="line">		-p 容器端口</span><br><span class="line">		容器端口</span><br><span class="line">		-p IP:主机端口:容器端口</span><br><span class="line">-P  <span class="comment"># 随机指定端口</span></span><br><span class="line">--<span class="built_in">rm</span> <span class="comment"># 退出后自动删除容器</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker run -i -t centos /bin/bash <span class="comment"># 启动并进入容器</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># exit 退出并停止容器</span></span><br><span class="line"><span class="comment"># ctrl p q 退出并不停止容器</span></span><br><span class="line"></span><br><span class="line">docker ps -a <span class="comment"># 查看所有容器</span></span><br><span class="line">docker ps <span class="comment"># 查看当前运行中的容器</span></span><br><span class="line">docker ps -n 3 <span class="comment"># 查看最近的三个容器</span></span><br><span class="line">docker ps -q <span class="comment"># show container id only</span></span><br><span class="line">docker <span class="built_in">rm</span> XXX <span class="comment"># 删除容器 无法删除运行中的容器</span></span><br><span class="line">docker <span class="built_in">rm</span> -f XXX <span class="comment"># 强制删除容器</span></span><br></pre></td></tr></table></figure>

<h3 id="启动和停止容器"><a href="#启动和停止容器" class="headerlink" title="启动和停止容器"></a>启动和停止容器</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker start 容器<span class="built_in">id</span></span><br><span class="line">docker restart 容器<span class="built_in">id</span></span><br><span class="line">docker stop 容器<span class="built_in">id</span></span><br><span class="line">docker <span class="built_in">kill</span> 容器<span class="built_in">id</span></span><br></pre></td></tr></table></figure>

<h3 id="常用其他命令"><a href="#常用其他命令" class="headerlink" title="常用其他命令"></a>常用其他命令</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># docker run -d IMAGE_ID 必须要有前台进程 不然会听停止</span></span><br><span class="line"></span><br><span class="line">docker logs container_id <span class="comment"># 查看容器日志</span></span><br><span class="line">docker run -d cents /bin/bash -c <span class="string">&quot;while true;do echo kuangshen;sleep 1;done&quot;</span></span><br><span class="line">docker logs -t -f container_id <span class="comment"># 从头开始查看日志</span></span><br><span class="line">docker top container_id <span class="comment"># 查看容器中的进程信息</span></span><br><span class="line">docker inspect container_id <span class="comment"># 查看容器元信息</span></span><br></pre></td></tr></table></figure>

<h3 id="进入当前运行的容器"><a href="#进入当前运行的容器" class="headerlink" title="进入当前运行的容器"></a>进入当前运行的容器</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -i -t 容器<span class="built_in">id</span> bashshell <span class="comment"># 进入当前容器并新开一个shell</span></span><br><span class="line">docker <span class="built_in">exec</span> -i -t 容器<span class="built_in">id</span> shell命令 <span class="comment"># 进入容器 执行shell命令 退出容器</span></span><br><span class="line">docker attach 容器<span class="built_in">id</span> <span class="comment"># 直接进入当前容器</span></span><br></pre></td></tr></table></figure>

<h3 id="从容器拷贝文件到主机上或反之"><a href="#从容器拷贝文件到主机上或反之" class="headerlink" title="从容器拷贝文件到主机上或反之"></a>从容器拷贝文件到主机上或反之</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">cp</span> 容器<span class="built_in">id</span>:容器内文件路径 目的主机文件路径</span><br><span class="line">docker <span class="built_in">cp</span> 目的主机文件路径 容器<span class="built_in">id</span>:容器内文件路径</span><br></pre></td></tr></table></figure>

<h3 id="例子-配置nginx"><a href="#例子-配置nginx" class="headerlink" title="例子 配置nginx"></a>例子 配置nginx</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker search nginx --filter is-official=<span class="literal">true</span></span><br><span class="line">docker pull nginx:latest</span><br><span class="line">docker run --name <span class="string">&quot;My_Nginx&quot;</span> -d -p 12718:80 nginx</span><br><span class="line">curl localhost:12718 <span class="comment"># 测试是否运行</span></span><br><span class="line">docker <span class="built_in">exec</span> -it NGINX_CONTAINER_ID /bin/bash <span class="comment"># 进入容器</span></span><br><span class="line">docker stop NGINX_CONTAINER_ID <span class="comment"># 停止容器</span></span><br></pre></td></tr></table></figure>

<h3 id="例子-配置tomcat"><a href="#例子-配置tomcat" class="headerlink" title="例子 配置tomcat"></a>例子 配置tomcat</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker pull tomcat</span><br><span class="line">docker run -d -p 12310:8080 --name tomcat01 tomcat</span><br><span class="line">docker <span class="built_in">exec</span> -i -t tomcat01 /bin/bash</span><br><span class="line"><span class="comment"># 因为tomcat镜像默认最小 所有不必要的功能被阉割 只保证最小运行 所以需要通过下面命令还原</span></span><br><span class="line">docker <span class="built_in">exec</span> -i -t tomcat01 /bin/bash</span><br><span class="line"><span class="built_in">cp</span> -vr webapps.dist/* webapps/</span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure>

<h3 id="使用portainer管理docker"><a href="#使用portainer管理docker" class="headerlink" title="使用portainer管理docker"></a>使用portainer管理docker</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker volume create portainer_data</span><br><span class="line">docker run -d -p 8000:8000 -p 9443:9443 --name portainer \</span><br><span class="line">    --restart=always \</span><br><span class="line">    -v /var/run/docker.sock:/var/run/docker.sock \</span><br><span class="line">    -v portainer_data:/data \</span><br><span class="line">    cr.portainer.io/portainer/portainer-ce:2.9.3</span><br><span class="line"><span class="comment"># 访问测试 https://localhost:9443</span></span><br></pre></td></tr></table></figure>

<h3 id="Commit-提交容器形成新镜像"><a href="#Commit-提交容器形成新镜像" class="headerlink" title="Commit 提交容器形成新镜像"></a>Commit 提交容器形成新镜像</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker commit -m <span class="string">&quot;描述信息&quot;</span> -a <span class="string">&quot;作者名&quot;</span> 容器<span class="built_in">id</span> 目标镜像名:[TAG]</span><br></pre></td></tr></table></figure>

<h4 id="容器数据卷-数据持久化-比如mysql数据在本地"><a href="#容器数据卷-数据持久化-比如mysql数据在本地" class="headerlink" title="容器数据卷 (数据持久化 比如mysql数据在本地)"></a>容器数据卷 (数据持久化 比如mysql数据在本地)</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -i -t -v 主机目录:容器内目录</span><br></pre></td></tr></table></figure>

<h3 id="配置mysql可持久化"><a href="#配置mysql可持久化" class="headerlink" title="配置mysql可持久化"></a>配置mysql可持久化</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql</span><br><span class="line"><span class="built_in">touch</span> ~/temp</span><br><span class="line">docker run -d -v ~/temp/conf:/etc/mysql/conf.d -v ~/temp/data:/var/lib/mysql -p 3310:3306 --name mysql01 -e MYSQL_ROOT_PASSWORD=123456 mysql:8.0</span><br></pre></td></tr></table></figure>

<h3 id="具名和匿名挂载"><a href="#具名和匿名挂载" class="headerlink" title="具名和匿名挂载"></a>具名和匿名挂载</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-v 容器内挂载</span><br><span class="line">docker volume <span class="built_in">ls</span> <span class="comment"># 查看所有挂载 包括具名和匿名的</span></span><br><span class="line">docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx nginx:latest <span class="comment"># 具名挂载</span></span><br><span class="line"><span class="comment"># docker -v /宿主机路径:容器内路径 指定路径挂载</span></span><br><span class="line">docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx:ro nginx:latest <span class="comment"># read only (rw: read and write 一旦设置了容器权限 则容器对我们挂载出来的内容就限定了)</span></span><br></pre></td></tr></table></figure>

<h3 id="Dockerfile-用来构建docker镜像的构建文件"><a href="#Dockerfile-用来构建docker镜像的构建文件" class="headerlink" title="Dockerfile 用来构建docker镜像的构建文件"></a>Dockerfile 用来构建docker镜像的构建文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FROM centos:latest</span><br><span class="line">VOLUME [&quot;volmne1&quot;, &quot;volume2&quot;]</span><br><span class="line">CMD /bin/bash</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -f DOCKER_FILE_LOCATION -t new_centos:3.1415 .</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 多个mysql数据同步</span></span><br><span class="line"><span class="comment"># 启动3个容器</span></span><br><span class="line">docker run -i -t --name mycentos02 --volumes-from 8101fb5bda0c  972f5a221cad <span class="comment"># 运行镜像972f5a221cad并且挂载继承容器8101fb5bda0c</span></span><br><span class="line"><span class="comment"># volume的生命周期会从创建到没有容器使用它为止 如果持久化到本地 则永远不会被删除</span></span><br></pre></td></tr></table></figure>

<h3 id="Dockerfile-基础知识"><a href="#Dockerfile-基础知识" class="headerlink" title="Dockerfile 基础知识"></a>Dockerfile 基础知识</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">FROM <span class="comment"># 基础镜像</span></span><br><span class="line">MAINTAINER <span class="comment"># 维护者信息</span></span><br><span class="line">RUN <span class="comment"># 镜像构建时候需要运行的命令</span></span><br><span class="line">ADD <span class="comment"># 往镜像中加东西</span></span><br><span class="line">WORKDIR <span class="comment"># 指定镜像工作目录</span></span><br><span class="line">VOLUME <span class="comment"># 定义挂载目录</span></span><br><span class="line">EXPOSE <span class="comment"># 指定对外端口</span></span><br><span class="line">CMD <span class="comment"># 指定容器启动时要执行的命令 只能用一次</span></span><br><span class="line">ENTRYPOINT <span class="comment"># 指定容器启动时要执行的命令 用来命令追加</span></span><br><span class="line">ONBUILD <span class="comment"># 当构建一个被继承Dockerfile时会触发</span></span><br><span class="line">COPY <span class="comment"># 类似ADD 把文件拷贝到镜像中</span></span><br><span class="line">ENV <span class="comment"># 设置环境变量</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">history</span> -H 0389acd48f36 <span class="comment"># 查看镜像构建历史</span></span><br><span class="line">IMAGE          CREATED             CREATED BY                                      SIZE      COMMENT</span><br><span class="line">0389acd48f36   About an hour ago   ENTRYPOINT [<span class="string">&quot;java&quot;</span> <span class="string">&quot;-jar&quot;</span> <span class="string">&quot;/demo-1.0.0.jar&quot;</span>]    0B        buildkit.dockerfile.v0</span><br><span class="line">&lt;missing&gt;      About an hour ago   COPY target/demo-1.0.0.jar demo-1.0.0.jar <span class="comment"># …   32.2MB    buildkit.dockerfile.v0</span></span><br><span class="line">&lt;missing&gt;      About an hour ago   MAINTAINER Haohu                                0B        buildkit.dockerfile.v0</span><br><span class="line">&lt;missing&gt;      2 weeks ago         /bin/sh -c <span class="built_in">set</span> -eux;   <span class="built_in">arch</span>=<span class="string">&quot;<span class="subst">$(dpkg --print-…   209MB</span></span></span><br><span class="line"><span class="subst"><span class="string">&lt;missing&gt;      2 weeks ago         /bin/sh -c #(nop)</span>  ENV JAVA_VERSION=8u322       0B</span></span><br><span class="line"><span class="string">&lt;missing&gt;      3 weeks ago         /bin/sh -c #(nop)  ENV LANG=C.UTF-8             0B</span></span><br><span class="line"><span class="string">&lt;missing&gt;      3 weeks ago         /bin/sh -c #(nop)  ENV PATH=/usr/local/openj…   0B</span></span><br><span class="line"><span class="string">&lt;missing&gt;      3 weeks ago         /bin/sh -c &#123; echo &#x27;#/bin/sh&#x27;; echo &#x27;echo &quot;</span><span class="variable">$J</span>…   27B</span><br><span class="line">&lt;missing&gt;      3 weeks ago         /bin/sh -c <span class="comment">#(nop)  ENV JAVA_HOME=/usr/local/…   0B</span></span><br><span class="line">&lt;missing&gt;      3 weeks ago         /bin/sh -c <span class="built_in">set</span> -eux;  apt-get update;  apt-g…   11.3MB</span><br><span class="line">&lt;missing&gt;      3 weeks ago         /bin/sh -c apt-get update &amp;&amp; apt-get install…   152MB</span><br><span class="line">&lt;missing&gt;      3 weeks ago         /bin/sh -c <span class="built_in">set</span> -ex;  <span class="keyword">if</span> ! <span class="built_in">command</span> -v gpg &gt; /…   18.9MB</span><br><span class="line">&lt;missing&gt;      3 weeks ago         /bin/sh -c <span class="built_in">set</span> -eux;  apt-get update;  apt-g…   10.7MB</span><br><span class="line">&lt;missing&gt;      3 weeks ago         /bin/sh -c <span class="comment">#(nop)  CMD [&quot;bash&quot;]                 0B</span></span><br><span class="line">&lt;missing&gt;      3 weeks ago         /bin/sh -c <span class="comment">#(nop) ADD file:9cca7f8e4abcd8309…   124MB</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用ghcr io上传镜像到个人github</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$CR_PAT</span>| docker login ghcr.io -u H-Shen --password-stdin</span><br><span class="line">docker tag 0389acd48f36 ghcr.io/h-shen/demo <span class="comment"># 改tag</span></span><br><span class="line">docker push ghcr.io/h-shen/demo <span class="comment"># 推包</span></span><br><span class="line">docker pull ghcr.io/h-shen/demo:latest <span class="comment"># 拉包</span></span><br></pre></td></tr></table></figure>

<h3 id="Docker-网络"><a href="#Docker-网络" class="headerlink" title="Docker 网络"></a>Docker 网络</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Docker For Mac没有docker0 网桥 不能实现host网络模式 </span></span><br><span class="line"><span class="comment"># linux宿主机能和容器ping通(veth-pair) mac不行因为底层虚拟机实现不支持</span></span><br><span class="line"><span class="comment"># 容器之间可以ping通</span></span><br></pre></td></tr></table></figure>

<h3 id="通过-–link-进行容器互联"><a href="#通过-–link-进行容器互联" class="headerlink" title="通过 –link 进行容器互联"></a>通过 –link 进行容器互联</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -P --name tomcat01 镜像<span class="built_in">id</span></span><br><span class="line">docker run -d -P --<span class="built_in">link</span> tomcat01 --name tomcat02 镜像<span class="built_in">id</span></span><br><span class="line">docker <span class="built_in">exec</span> -i -t tomcat02 ping tomcat01   <span class="comment"># 此时可以通过容器名ping</span></span><br><span class="line"><span class="comment"># 缺点是link是单向的</span></span><br><span class="line">docker <span class="built_in">exec</span> -i -t tomcat02 <span class="built_in">cat</span> /etc/hosts <span class="comment"># link本质:通过写hosts使得容器名可以ping通</span></span><br></pre></td></tr></table></figure>

<h3 id="自定义网络"><a href="#自定义网络" class="headerlink" title="自定义网络"></a>自定义网络</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">docker network <span class="built_in">ls</span> <span class="comment"># 列出所有docker网络</span></span><br><span class="line"><span class="comment"># docker 网络模式</span></span><br><span class="line"><span class="comment"># 1. bridge 桥接 (默认)</span></span><br><span class="line"><span class="comment"># 2. none 不配置网络</span></span><br><span class="line"><span class="comment"># 3. host 和宿主机共享网络</span></span><br><span class="line"><span class="comment"># 4. container 容器内网络连通</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># docker run 默认 --net bridge</span></span><br><span class="line"><span class="comment"># docker run -d -P --name tomcat01 --net bridge tomcat:latest</span></span><br><span class="line">docker network create -d bridge --subnet 177.77.0.0/16 --gateway 177.77.0.1 myNet</span><br><span class="line"><span class="comment"># 177.77.0.0/16: 177.77.0.2---177.77.255.255</span></span><br><span class="line">docker run -t -d --name centos01 --net myNet centos:latest</span><br><span class="line">docker run -t -d --name centos02 --net myNet centos:latest</span><br><span class="line">docker run -t -d --name centos03 --net myNet centos:latest</span><br><span class="line">docker <span class="built_in">exec</span> -i -t centos01 ping -c 5 centos02</span><br><span class="line">docker <span class="built_in">exec</span> -i -t centos02 ping -c 5 centos01</span><br><span class="line">docker <span class="built_in">exec</span> -i -t centos03 ping -c 5 centos01</span><br><span class="line">docker <span class="built_in">exec</span> -i -t centos03 ping -c 5 www.google.com</span><br><span class="line"><span class="comment"># 此时可以通过容器名或容器id相互连通, 各容器也能和外网连通</span></span><br></pre></td></tr></table></figure>

<h3 id="网络连通"><a href="#网络连通" class="headerlink" title="网络连通"></a>网络连通</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打通网络</span></span><br><span class="line">docker run -t -d --name centos04 centos:latest</span><br><span class="line">docker network connect myNet centos04</span><br><span class="line">docker network inspect myNet</span><br><span class="line"><span class="comment">####</span></span><br><span class="line"><span class="string">&quot;7041a3f5db94c8adb960409ccf04d57d4d022d74220bcac8b96f63c88184d738&quot;</span>: &#123;</span><br><span class="line">	<span class="string">&quot;Name&quot;</span>: <span class="string">&quot;centos04&quot;</span>,</span><br><span class="line">	<span class="string">&quot;EndpointID&quot;</span>: <span class="string">&quot;b2f648756621a2e56d12113a2668e53875ace62af9c1697a75b8a307a0f222a2&quot;</span>,</span><br><span class="line">	<span class="string">&quot;MacAddress&quot;</span>: <span class="string">&quot;02:42:c0:a8:00:05&quot;</span>,</span><br><span class="line">	<span class="string">&quot;IPv4Address&quot;</span>: <span class="string">&quot;177.77.0.5/16&quot;</span>,</span><br><span class="line">	<span class="string">&quot;IPv6Address&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">####</span></span><br><span class="line"><span class="comment"># 此时容器centos04被赋予新的ip地址 即一个容器 两个ip</span></span><br><span class="line">docker network disconnect -f myNet centos04 <span class="comment"># 取消打通</span></span><br></pre></td></tr></table></figure>

<h3 id="Redis-集群部署"><a href="#Redis-集群部署" class="headerlink" title="Redis 集群部署"></a>Redis 集群部署</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 3个master 3个slave</span></span><br><span class="line"><span class="comment"># 新建一个redis专属网络</span></span><br><span class="line">docker network create -d bridge --subnet 177.77.0.0/16 redisNet</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -x</span><br><span class="line"><span class="comment"># 通过脚本设置集群</span></span><br><span class="line"><span class="keyword">for</span> (( i=<span class="number">1</span>; i&lt;=<span class="number">6</span>; i+=<span class="number">1</span>))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">mkdir</span> -p ~/temp/redis/node-<span class="variable">$&#123;i&#125;</span>/conf</span><br><span class="line"><span class="built_in">touch</span> ~/temp/redis/node-<span class="variable">$&#123;i&#125;</span>/conf/redis.conf</span><br><span class="line"><span class="built_in">cat</span> &gt; ~/temp/redis/node-<span class="variable">$&#123;i&#125;</span>/conf/redis.conf &lt;&lt; <span class="string">EOF</span></span><br><span class="line"><span class="string">port 6379</span></span><br><span class="line"><span class="string">bind 0.0.0.0</span></span><br><span class="line"><span class="string">cluster-enabled yes</span></span><br><span class="line"><span class="string">cluster-config-file nodes.conf</span></span><br><span class="line"><span class="string">cluster-node-timeout 5000</span></span><br><span class="line"><span class="string">cluster-announce-ip 177.77.0.1$&#123;i&#125;</span></span><br><span class="line"><span class="string">cluster-announce-port 6379</span></span><br><span class="line"><span class="string">cluster-announce-bus-port 16379</span></span><br><span class="line"><span class="string">appendonly yes</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动容器</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"><span class="built_in">set</span> -x</span><br><span class="line"><span class="keyword">for</span> (( i=<span class="number">1</span>; i&lt;=<span class="number">6</span>; i+=<span class="number">1</span>))</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">docker run -p 637<span class="variable">$&#123;i&#125;</span>:6379 -p 1637<span class="variable">$&#123;i&#125;</span>:16379 --name redis-<span class="variable">$&#123;i&#125;</span> -v ~/temp/redis/node-<span class="variable">$&#123;i&#125;</span>/data:/data \</span><br><span class="line">-v ~/temp/redis/node-<span class="variable">$&#123;i&#125;</span>/conf/redis.conf:/etc/redis/redis.conf -d --net redisNet --ip 177.77.0.1<span class="variable">$&#123;i&#125;</span> \</span><br><span class="line">redis:6.2.6-alpine redis-server /etc/redis/redis.conf</span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 进入redis-1并创建集群</span></span><br><span class="line">docker <span class="built_in">exec</span> -i -t redis-1 /bin/sh</span><br><span class="line">redis-cli --cluster create 177.77.0.11:6379 177.77.0.12:6379 177.77.0.13:6379 177.77.0.14:6379 177.77.0.15:6379 177.77.0.16:6379 --cluster-replicas 1</span><br><span class="line">&gt;&gt;&gt; Performing <span class="built_in">hash</span> slots allocation on 6 nodes...</span><br><span class="line">Master[0] -&gt; Slots 0 - 5460</span><br><span class="line">Master[1] -&gt; Slots 5461 - 10922</span><br><span class="line">Master[2] -&gt; Slots 10923 - 16383</span><br><span class="line">Adding replica 177.77.0.15:6379 to 177.77.0.11:6379</span><br><span class="line">Adding replica 177.77.0.16:6379 to 177.77.0.12:6379</span><br><span class="line">Adding replica 177.77.0.14:6379 to 177.77.0.13:6379</span><br><span class="line">M: 1155974119ef1a7cda4c697b953542d1dec3ad6b 177.77.0.11:6379</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">M: f8ffb5e62d997e9589c799a9dcf01c7ba5c5d3a5 177.77.0.12:6379</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">M: b30e853f4413eb1449789ed97ee6cc68ea1afda5 177.77.0.13:6379</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">S: ab81cd2697b36723151df909954c3f9a858eadc4 177.77.0.14:6379</span><br><span class="line">   replicates b30e853f4413eb1449789ed97ee6cc68ea1afda5</span><br><span class="line">S: 1250214f6150781c6285a2cbf34800a76a325b4b 177.77.0.15:6379</span><br><span class="line">   replicates 1155974119ef1a7cda4c697b953542d1dec3ad6b</span><br><span class="line">S: cf53516ef058b0eded33f5e673d1f3458f92d92d 177.77.0.16:6379</span><br><span class="line">   replicates f8ffb5e62d997e9589c799a9dcf01c7ba5c5d3a5</span><br><span class="line">Can I <span class="built_in">set</span> the above configuration? (<span class="built_in">type</span> <span class="string">&#x27;yes&#x27;</span> to accept): <span class="built_in">yes</span></span><br><span class="line">&gt;&gt;&gt; Nodes configuration updated</span><br><span class="line">&gt;&gt;&gt; Assign a different config epoch to each node</span><br><span class="line">&gt;&gt;&gt; Sending CLUSTER MEET messages to <span class="built_in">join</span> the cluster</span><br><span class="line">Waiting <span class="keyword">for</span> the cluster to <span class="built_in">join</span></span><br><span class="line">..</span><br><span class="line">&gt;&gt;&gt; Performing Cluster Check (using node 177.77.0.11:6379)</span><br><span class="line">M: 1155974119ef1a7cda4c697b953542d1dec3ad6b 177.77.0.11:6379</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 1250214f6150781c6285a2cbf34800a76a325b4b 177.77.0.15:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 1155974119ef1a7cda4c697b953542d1dec3ad6b</span><br><span class="line">M: b30e853f4413eb1449789ed97ee6cc68ea1afda5 177.77.0.13:6379</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: ab81cd2697b36723151df909954c3f9a858eadc4 177.77.0.14:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates b30e853f4413eb1449789ed97ee6cc68ea1afda5</span><br><span class="line">M: f8ffb5e62d997e9589c799a9dcf01c7ba5c5d3a5 177.77.0.12:6379</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: cf53516ef058b0eded33f5e673d1f3458f92d92d 177.77.0.16:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates f8ffb5e62d997e9589c799a9dcf01c7ba5c5d3a5</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line">&gt;&gt;&gt; Check <span class="keyword">for</span> open slots...</span><br><span class="line">&gt;&gt;&gt; Check slots coverage...</span><br><span class="line">[OK] All 16384 slots covered.</span><br><span class="line"></span><br><span class="line">redis-cli -c</span><br><span class="line">cluster nodes <span class="comment"># 查询集群</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Docker-Compose"><a href="#Docker-Compose" class="headerlink" title="Docker Compose"></a>Docker Compose</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用来定义和运行多个容器</span></span><br><span class="line"><span class="comment"># 定义docker compose三步骤</span></span><br><span class="line"><span class="comment"># 1. 定义Dockerfile</span></span><br><span class="line"><span class="comment"># 2. 定义docker-compose.yaml</span></span><br><span class="line"><span class="comment"># 3. docker-compose up 启动</span></span><br><span class="line"><span class="comment"># 作用: 批量容器编排</span></span><br></pre></td></tr></table></figure>

<p>Compose重要概念</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 服务services 即容器</span></span><br><span class="line"><span class="comment"># 项目project 一组关联的容器</span></span><br><span class="line">docker-compose build --no-cache <span class="comment"># 不使用缓存新建compose对象</span></span><br><span class="line">docker-compose up <span class="comment"># 启动容器</span></span><br><span class="line">docker-compose down <span class="comment"># 在docker-compose yaml文件夹下运行 让docker识别具体停止哪些服务</span></span><br></pre></td></tr></table></figure>

<p>Compose Yaml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;&quot;</span> <span class="comment"># docker-compose版本 可省略</span></span><br><span class="line"><span class="attr">services:</span> <span class="comment"># 服务</span></span><br><span class="line">	<span class="string">服务1:</span> <span class="string">web</span></span><br><span class="line">	<span class="string">服务2:</span> <span class="string">redis</span></span><br><span class="line">		<span class="comment"># 服务配置</span></span><br><span class="line">		<span class="attr">images:</span> </span><br><span class="line">		<span class="attr">build:</span> </span><br><span class="line">		<span class="attr">network:</span> </span><br><span class="line">		<span class="attr">depends_on:</span></span><br><span class="line">			<span class="bullet">-</span> <span class="string">服务3</span></span><br><span class="line">			<span class="bullet">-</span> <span class="string">服务4</span></span><br><span class="line">			<span class="comment"># 先启动服务3 服务4 再启动服务2</span></span><br><span class="line"><span class="comment"># 其他配置 网络 卷挂载</span></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line"><span class="attr">configs:</span></span><br></pre></td></tr></table></figure>

<h3 id="删除所有缓存"><a href="#删除所有缓存" class="headerlink" title="删除所有缓存"></a>删除所有缓存</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker system prune -a</span><br></pre></td></tr></table></figure>

<h3 id="一些快速应用"><a href="#一些快速应用" class="headerlink" title="一些快速应用"></a>一些快速应用</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 搭建mysql并映射到本地3310</span></span><br><span class="line">docker run -d -p 3310:3306 --name mysql01 -e MYSQL_ROOT_PASSWORD=123456 mysql:8.0</span><br></pre></td></tr></table></figure>

</article></div></main><div class="nav-wrap"><div class="nav"><button class="site-nav"><div class="navicon"></div></button><ul class="nav_items"><li class="nav_item"><a class="nav-page" href="/about"> About</a></li><li class="nav_item"><a class="nav-page" href="/blogs"> Blogs</a></li><li class="nav_item"><a class="nav-page" href="/projects"> Projects</a></li><li class="nav_item"><a class="nav-page" href="/notes"> Notes</a></li></ul></div><div class="cd-top"><i class="fa fa-arrow-up" aria-hidden="true"></i></div></div><footer id="page_footer"><div class="footer_wrap"><div class="copyright">&copy;2023 by Haohu Shen</div><div class="theme-info">Powered by <a target="_blank" href="https://hexo.io" rel="nofollow noopener">Hexo</a> & <a target="_blank" href="https://github.com/PhosphorW/hexo-theme-academia" rel="nofollow noopener">Academia Theme</a></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery-pjax@latest/jquery.pjax.min.js"></script><script src="/js/main.js"></script></body></html>