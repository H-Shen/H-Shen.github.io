<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>Haohu Shen's ePortfolio</title><meta name="author" content="Haohu Shen"><link rel="shortcut icon" href="/img/favicon.png"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.0.0"><link rel="alternate" href="/atom.xml" title="Haohu Shen's ePortfolio" type="application/atom+xml">
</head><body><header id="page_header"><div class="header_wrap"><div id="blog_name"><a class="blog_title" id="site-name" href="/">Haohu Shen's ePortfolio</a></div><button class="menus_icon"><div class="navicon"></div></button><ul class="menus_items"><li class="menus_item"><a class="site-page" href="/about"> About</a></li><li class="menus_item"><a class="site-page" href="/blogs"> Blogs</a></li><li class="menus_item"><a class="site-page" href="/projects"> Projects</a></li><li class="menus_item"><a class="site-page" href="/notes"> Notes</a></li></ul></div></header><main id="page_main"><div class="side-card sticky"><div class="card-wrap" itemscope itemtype="http://schema.org/Person"><div class="author-avatar"><img class="avatar-img" src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/profile.png'" alt="avatar"></div><div class="author-discrip"><h3>Haohu Shen</h3><p class="author-bio">Premature optimization is the root of all evil.</p></div><div class="author-links"><button class="btn m-social-links">Links</button><ul class="social-icons"><li><a class="social-icon" href="https://github.com/H-Shen" target="_blank"><i class="fab fa-github" aria-hidden="true"></i></a></li><li><a class="social-icon" href="https://stackoverflow.com/users/6844098/haohu-shen" target="_blank"><i class="fab fa-stack-overflow" aria-hidden="true"></i></a></li><li><a class="social-icon" href="https://www.linkedin.com/notifications/?filter=all" target="_blank"><i class="fab fa-linkedin" aria-hidden="true"></i></a></li><li><a class="social-icon" href="mailto:haohu3991@gmail.com" target="_blank"><i class="fas fa-envelope" aria-hidden="true"></i></a></li></ul></div></div></div><div class="page" itemscope itemtype="http://schema.org/CreativeWork"><h2 class="page-title"></h2><article><h3 id="Benchmark-the-Fastest-Way-of-I-O-in-C-for-Coding-Competition"><a href="#Benchmark-the-Fastest-Way-of-I-O-in-C-for-Coding-Competition" class="headerlink" title="Benchmark the Fastest Way of I&#x2F;O in C++ for Coding Competition"></a>Benchmark the Fastest Way of I&#x2F;O in C++ for Coding Competition</h3><h4 id="Contents"><a href="#Contents" class="headerlink" title="Contents"></a>Contents</h4><h5 id="0x00-Preface"><a href="#0x00-Preface" class="headerlink" title="0x00 Preface"></a>0x00 Preface</h5><h5 id="0x01-How-to-set-the-benchmark-of-different-ways-of-I-O"><a href="#0x01-How-to-set-the-benchmark-of-different-ways-of-I-O" class="headerlink" title="0x01 How to set the benchmark of different ways of I&#x2F;O?"></a>0x01 How to set the benchmark of different ways of I&#x2F;O?</h5><h5 id="0x02-How-to-wrap-the-faster-way-of-I-O"><a href="#0x02-How-to-wrap-the-faster-way-of-I-O" class="headerlink" title="0x02 How to wrap the faster way of I&#x2F;O?"></a>0x02 How to wrap the faster way of I&#x2F;O?</h5><h5 id="0x03-How-to-tweak-the-faster-way-of-I-O-to-handle-different-variadic-arguments"><a href="#0x03-How-to-tweak-the-faster-way-of-I-O-to-handle-different-variadic-arguments" class="headerlink" title="0x03 How to tweak the faster way of I&#x2F;O to handle different variadic arguments?"></a>0x03 How to tweak the faster way of I&#x2F;O to handle different variadic arguments?</h5><h5 id="0x04-What-you-should-know-if-you-want-to-use-the-wrapper-in-a-real-competition"><a href="#0x04-What-you-should-know-if-you-want-to-use-the-wrapper-in-a-real-competition" class="headerlink" title="0x04 What you should know if you want to use the wrapper in a real competition?"></a>0x04 What you should know if you want to use the wrapper in a real competition?</h5><h5 id="0x05-Reference"><a href="#0x05-Reference" class="headerlink" title="0x05 Reference"></a>0x05 Reference</h5><h4 id="0x00-Preface-1"><a href="#0x00-Preface-1" class="headerlink" title="0x00 Preface"></a>0x00 Preface</h4><p>When a coding competitor encounters a problem that requires a large size of input&#x2F;output and limited time, I&#x2F;O will become the bottleneck of the solution. Especially C++ programmers will find that <strong>cin&#x2F;cout</strong> will always be slower than <strong>scanf&#x2F;printf</strong>, thus in this article, I will share with you guys how I find the fastest way to read from standard input and write to standard output in C++ by setting up a benchmark and how I wrap the facility in a coding competition. Finally, I will share with you some tips you should notice if you really want to use the code for fast input&#x2F;output, and a disadvantage of it.</p>
<p>On the other hand, since in most competitions, problem graders are running on a Linux machine and the source code of C++ will be compiled in GCC, I decided to use the following environment to benchmark the code for faster I&#x2F;O:</p>
<ul>
<li>Fedora in csx.cs.ucalgary.ca by Secured Shell</li>
<li>Compile in g++ with -O2 using C++17 standard</li>
</ul>
<p>In this way, you can also verify or re-benchmark by yourself.</p>
<h4 id="0x01-How-to-set-the-benchmark-of-different-ways-of-I-O-1"><a href="#0x01-How-to-set-the-benchmark-of-different-ways-of-I-O-1" class="headerlink" title="0x01 How to set the benchmark of different ways of I&#x2F;O?"></a>0x01 How to set the benchmark of different ways of I&#x2F;O?</h4><p>In most cases, if a problem requires large size of input&#x2F;output and limited time in the coding competitions, we can assume that the data type for input&#x2F;output is <strong>integers</strong>, therefore, in order to benchmark, we need a generator that creates specified random integers to a specified external file, as below:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">static</span></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">create_data</span><span class="params">(<span class="type">const</span> <span class="type">size_t</span> &amp;data_size, <span class="type">const</span> std::string &amp;file_name)</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Initialize a random number generator.</span></span><br><span class="line">    std::random_device dev;</span><br><span class="line">    <span class="function">std::mt19937 <span class="title">random_generator</span><span class="params">(dev())</span></span>;</span><br><span class="line">    <span class="function">std::uniform_int_distribution&lt;<span class="type">int</span>&gt; <span class="title">dist</span><span class="params">(std::numeric_limits&lt;<span class="type">int</span>&gt;::min(),</span></span></span><br><span class="line"><span class="params"><span class="function">                                            std::numeric_limits&lt;<span class="type">int</span>&gt;::max())</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Create an empty file</span></span><br><span class="line">    std::fstream file;</span><br><span class="line">    file.<span class="built_in">open</span>(file_name, std::ios::out);</span><br><span class="line">    <span class="keyword">if</span> (!file) &#123;</span><br><span class="line">        std::cerr &lt;&lt; <span class="string">&quot;Failed to create the test file!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Write into a file</span></span><br><span class="line">    std::ofstream myFile;</span><br><span class="line">    myFile.<span class="built_in">open</span>(file_name);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i != data_size; ++i) &#123;</span><br><span class="line">        myFile &lt;&lt; <span class="built_in">dist</span>(random_generator) &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    myFile.<span class="built_in">close</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>On the other hand, to benchmark different methods, I decide to generate 10000000 integers, start measuring the time <strong>before</strong> reading from standard input or writing to standard output and stop measuring the time once the job is done, as below:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">test_func</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    std::chrono::time_point&lt;std::chrono::steady_clock&gt; start, stop;</span><br><span class="line">    std::chrono::duration&lt;<span class="type">double</span>&gt; elapsed_in_seconds&#123;&#125;;</span><br><span class="line">    </span><br><span class="line">    start = std::chrono::steady_clock::<span class="built_in">now</span>();</span><br><span class="line">    <span class="comment">// Read/Write data here</span></span><br><span class="line">    stop = std::chrono::steady_clock::<span class="built_in">now</span>();</span><br><span class="line">    elapsed_in_seconds = stop-start;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Output the result to stdout</span></span><br><span class="line">    std::cerr &lt;&lt; <span class="string">&quot;result:  &quot;</span> &lt;&lt; elapsed_in_seconds.<span class="built_in">count</span>() &lt;&lt; <span class="string">&quot; seconds&quot;</span>&lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Cleaning the file for input</span></span><br><span class="line">    std::<span class="built_in">remove</span>(inputFile);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Right now, I am going to share with you all methods for reading and writing:</p>
<ul>
<li><strong>cin&#x2F;cout</strong></li>
</ul>
<p>For most C++ beginners, <strong>cin&#x2F;cout</strong> is a nice and convenient way to read from stdin until <strong>EOF</strong> and write to stdout, as below:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> input;</span><br><span class="line">    <span class="keyword">while</span> (std::cin &gt;&gt; std::input) &#123;</span><br><span class="line">        std::cout &lt;&lt; input &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The buffer will be flushed after every <strong>endl</strong>, thus we can make it quicker by flushing the buffer only once after EOF, like this:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> input;</span><br><span class="line">    <span class="keyword">while</span> (std::cin &gt;&gt; std::input) &#123;</span><br><span class="line">        std::cout &lt;&lt; input &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>cin&#x2F;cout</strong> without synchronization</li>
</ul>
<p>One reason that cin&#x2F;cout is slower is that for compatibility cin&#x2F;cout is designed to sync with printf&#x2F;scanf at default, thus the order of input&#x2F;output is clear if you mix using two pairs of different ways to handle I&#x2F;O. Thus we can cancel such sync and only use cin&#x2F;cout or printf&#x2F;scanf in our solution. In this way, the time cost of I&#x2F;O will be significantly reduced. Meanwhile, we can also cancel the binding between cin and cout. And don’t forget to avoid using endl for flushing the buffer only once, like this:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> input;</span><br><span class="line">    <span class="comment">// Stop synchronization with C stdio</span></span><br><span class="line">    std::ios_base::<span class="built_in">sync_with_stdio</span>(<span class="literal">false</span>);</span><br><span class="line">    <span class="comment">// Cancel binding</span></span><br><span class="line">    std::cin.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    std::cout.<span class="built_in">tie</span>(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="keyword">while</span> (std::cin &gt;&gt; std::input) &#123;</span><br><span class="line">        std::cout &lt;&lt; input &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>getchar&#x2F;putchar</strong></li>
</ul>
<p>If you parse the integer and output the integer by digits using <strong>getchar&#x2F;putchar</strong>, it will be faster than any methods above, meanwhile, we can use recursion in <strong>putchar</strong>, which is a little bit faster than using a stack to store each digit, as below:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Read and return false if EOF is encountered,</span></span><br><span class="line"><span class="comment">// otherwise return true</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span></span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">read</span><span class="params">(<span class="type">int</span> &amp;t)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> ch = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (ch == EOF) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        n |= ch == <span class="string">&#x27;-&#x27;</span>;     <span class="comment">// Handle negative numbers</span></span><br><span class="line">        ch = <span class="built_in">getchar</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    t = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) &#123;</span><br><span class="line">        t = t * <span class="number">10</span> + ch - <span class="number">48</span>;</span><br><span class="line">        ch = <span class="built_in">getchar</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (n) t = -t;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">write</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>) x = -x, <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>) <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(x % <span class="number">10</span> + <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> input;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">read</span>(input)) &#123;</span><br><span class="line">        <span class="built_in">write</span>(output);</span><br><span class="line">        <span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>If we only need to parse an integer and store it to a reference instead of checking if there is an EOF, we can use the code below, which is actually more common in competitions:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">read</span><span class="params">(<span class="type">int</span> &amp;t)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> c = <span class="built_in">getchar</span>();</span><br><span class="line">    t = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(c)) n |= c == <span class="string">&#x27;-&#x27;</span>, c = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">isdigit</span>(c)) t = t * <span class="number">10</span> + c - <span class="number">48</span>, c = <span class="built_in">getchar</span>();</span><br><span class="line">    <span class="keyword">if</span> (n) t = -t;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Moreover, since coders are allowed to use only a single thread in the competition, we don’t need to consider situations such as multi-threads, or sharing variables, thus we can replace <strong>getchar</strong> and <strong>putchar</strong> with their thread-unsafe versions, <strong>getchar_unlocked</strong> and <strong>putchar_unlocked</strong>. Similarly, we can use <strong>fputs_unlocked</strong> to output C-style strings.</p>
<ul>
<li><strong>fread&#x2F;fwrite</strong></li>
</ul>
<p>We can even make it faster by reading all input into a buffer using <strong>fread</strong> and outputting the whole contents from the buffer once and for all with <strong>fwrite</strong>, since coders are given the size of data in many coding problems, they are able to estimate the size of buffers used for input&#x2F;output. We use two pointers to point at these two buffers respectively, when a digit is parsed for input&#x2F;output, pointers will advance for a step as below, notice don’t forget to flush the buffer:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="keyword">constexpr</span> <span class="type">int</span> MAXSIZE = <span class="number">1024</span> * <span class="number">1024</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">char</span> input_buffer[MAXSIZE];</span><br><span class="line"><span class="type">static</span> <span class="type">char</span> *ptr1 = input_buffer + MAXSIZE;</span><br><span class="line"><span class="type">static</span> <span class="type">char</span> *ptr2 = input_buffer + MAXSIZE;</span><br><span class="line"><span class="type">static</span> <span class="type">char</span> output_buffer[MAXSIZE];</span><br><span class="line"><span class="type">static</span> <span class="type">char</span> *ptr = output_buffer;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">static</span></span></span><br><span class="line"><span class="function"><span class="type">char</span> <span class="title">my_getchar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (ptr1 == ptr2) &#123;</span><br><span class="line">        ptr1 = input_buffer;</span><br><span class="line">        ptr2 = input_buffer + <span class="built_in">fread</span>(input_buffer, <span class="number">1</span>, MAXSIZE, stdin);</span><br><span class="line">        <span class="keyword">if</span> (ptr1 == ptr2) &#123;</span><br><span class="line">            <span class="keyword">return</span> EOF;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> *ptr1++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">static</span></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">my_putchar</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;ch)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (ptr - output_buffer == MAXSIZE) &#123;</span><br><span class="line">        <span class="built_in">fwrite</span>(output_buffer, <span class="number">1</span>, MAXSIZE, stdout);</span><br><span class="line">        ptr = output_buffer;</span><br><span class="line">    &#125;</span><br><span class="line">    *ptr++ = ch;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">read</span><span class="params">(<span class="type">int</span> &amp;t)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> c = <span class="built_in">my_getchar</span>();</span><br><span class="line">    t = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(c)) n |= c == <span class="string">&#x27;-&#x27;</span>;, c = <span class="built_in">my_getchar</span>();</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">isdigit</span>(c)) t = t * <span class="number">10</span> + c - <span class="number">48</span>, c = <span class="built_in">my_getchar</span>();</span><br><span class="line">    <span class="keyword">if</span> (n) t = -t;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span></span></span><br><span class="line"><span class="function"><span class="title">write</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (x &lt; <span class="number">0</span>) x = -x, <span class="built_in">my_putchar</span>(<span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">if</span> (x &gt; <span class="number">9</span>) <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">    <span class="built_in">my_putchar</span>(x % <span class="number">10</span> + <span class="number">48</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Execute this function after using write() on all numbers for output.</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">flush</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">fwrite</span>(output_buffer, <span class="number">1</span>, ptr - output_buffer, stdout);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n = <span class="number">1000000</span>;</span><br><span class="line">    <span class="type">int</span> input;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="built_in">read</span>(input);</span><br><span class="line">        <span class="built_in">write</span>(input);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">my_putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    <span class="built_in">flush</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>More faster method of I&#x2F;O?</li>
</ul>
<p>Is there an even faster method for input&#x2F;output in C++? Well, instead of writing into a buffer, we can always map stdin into memory directly, it will be a little faster than <strong>fread</strong>. The function <strong>mmap</strong> helps us do the job easily, but it also requires us to include additional header files, if you really want to use it, make sure it is legal in the competition. Here I wrap a thread-unsafe <strong>mmap&#x2F;fwrite</strong> into a namespace:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/extc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/mman.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> FasterIO &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">static</span> <span class="keyword">constexpr</span> <span class="type">int</span> MAXSIZE = <span class="number">1024</span> * <span class="number">1024</span>;</span><br><span class="line">    <span class="type">static</span> <span class="type">char</span> *input_buffer = <span class="literal">nullptr</span>;</span><br><span class="line">    <span class="type">static</span> <span class="type">char</span> *ptr0;</span><br><span class="line">    <span class="type">static</span> <span class="type">char</span> output_buffer[MAXSIZE];</span><br><span class="line">    <span class="type">static</span> <span class="type">char</span> *ptr = output_buffer;</span><br><span class="line">    <span class="type">int</span> total_size;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">static</span></span></span><br><span class="line"><span class="function">    <span class="type">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">stat</span> sb; <span class="comment">// dont initialize it in order to save time</span></span><br><span class="line">        <span class="built_in">fstat</span>(<span class="built_in">fileno_unlocked</span>(stdin), &amp;sb);</span><br><span class="line">        total_size = sb.st_size;</span><br><span class="line">        input_buffer = <span class="built_in">reinterpret_cast</span>&lt;<span class="type">char</span> *&gt;(<span class="built_in">mmap</span>(<span class="literal">nullptr</span>, total_size,PROT_READ, MAP_PRIVATE,<span class="built_in">fileno_unlocked</span>(stdin),<span class="number">0</span>));</span><br><span class="line">        ptr0 = input_buffer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">static</span></span></span><br><span class="line"><span class="function">    <span class="type">char</span> <span class="title">getchar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ptr0 == input_buffer + total_size || *ptr0 == EOF) <span class="keyword">return</span> EOF;</span><br><span class="line">        <span class="keyword">return</span> *ptr0++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">read</span><span class="params">(<span class="type">int</span> &amp;t)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> c = <span class="built_in">getchar</span>();</span><br><span class="line">        t = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(c)) n |= c == <span class="string">&#x27;-&#x27;</span>, c = <span class="built_in">getchar</span>();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(c)) t = t * <span class="number">10</span> + c - <span class="number">48</span>, c = <span class="built_in">getchar</span>();</span><br><span class="line">        <span class="keyword">if</span> (n) t = -t;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">static</span></span></span><br><span class="line"><span class="function">    <span class="type">void</span> <span class="title">putchar</span><span class="params">(<span class="type">const</span> <span class="type">char</span> &amp;ch)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ptr - output_buffer == MAXSIZE) &#123;</span><br><span class="line">            <span class="built_in">fwrite_unlocked</span>(output_buffer, <span class="number">1</span>, MAXSIZE, stdout);</span><br><span class="line">            ptr = output_buffer;</span><br><span class="line">        &#125;</span><br><span class="line">        *ptr++ = ch;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (x &lt; <span class="number">0</span>) x = -x, <span class="built_in">putchar</span>(<span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (x &gt; <span class="number">9</span>) <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">        <span class="built_in">putchar</span>(x % <span class="number">10</span> + <span class="number">48</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">inline</span></span></span><br><span class="line"><span class="function">    <span class="type">void</span> <span class="title">flush</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">fwrite_unlocked</span>(output_buffer, <span class="number">1</span>, ptr - output_buffer, stdout);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Use freopen here if you want</span></span><br><span class="line">    <span class="comment">// Init before reading any data</span></span><br><span class="line">    FasterIO::<span class="built_in">init</span>();</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> n, input;</span><br><span class="line">    FasterIO::<span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        FasterIO::<span class="built_in">read</span>(input);</span><br><span class="line">        FasterIO::<span class="built_in">write</span>(input);</span><br><span class="line">        FasterIO::<span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Again, don&#x27;t forget to flush the buffer</span></span><br><span class="line">    FasterIO::<span class="built_in">flush</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>BENCHMARK</p>
<p>So what is the benchmark of different methods after all these tests? Well, here are two tables of results, I tested reading and writing 10000000 integers <strong>separately</strong> on the server of UofC by SSH:</p>
<p>For input, we have:</p>
<table>
<thead>
<tr>
<th>METHOD</th>
<th>TIME COST (seconds)</th>
</tr>
</thead>
<tbody><tr>
<td>mmap</td>
<td>0.333833</td>
</tr>
<tr>
<td>fread</td>
<td>0.493002</td>
</tr>
<tr>
<td>getchar unlocked</td>
<td>0.433707</td>
</tr>
<tr>
<td>getchar</td>
<td>0.619069</td>
</tr>
<tr>
<td>scanf</td>
<td>1.62939</td>
</tr>
<tr>
<td>cin without sync</td>
<td>1.7917</td>
</tr>
<tr>
<td>cin</td>
<td>5.04564</td>
</tr>
</tbody></table>
<p>Also, for output, we have:</p>
<table>
<thead>
<tr>
<th>METHOD</th>
<th>TIME COST (seconds)</th>
</tr>
</thead>
<tbody><tr>
<td>fwrite</td>
<td>0.735085</td>
</tr>
<tr>
<td>putchar unlocked</td>
<td>0.826488</td>
</tr>
<tr>
<td>putchar</td>
<td>0.815868</td>
</tr>
<tr>
<td>printf</td>
<td>1.41162</td>
</tr>
<tr>
<td>cout without sync</td>
<td>1.36623</td>
</tr>
<tr>
<td>cout</td>
<td>30.6118</td>
</tr>
</tbody></table>
<p>Now you see that different ways of I&#x2F;O may make a huge impact on the time cost of a routine in coding competitions. For unknown reasons, <strong>putchar unlocked</strong> is a little bit slower than <strong>putchar</strong>, but it will definitely be faster than <strong>printf</strong>.</p>
</li>
</ul>
<h4 id="0x02-How-to-wrap-the-faster-way-of-I-O-1"><a href="#0x02-How-to-wrap-the-faster-way-of-I-O-1" class="headerlink" title="0x02 How to wrap the faster way of I&#x2F;O?"></a>0x02 How to wrap the faster way of I&#x2F;O?</h4><p>Since <strong>mmap</strong> is only available in Linux machines and there are some problems out there that you cannot predict the size of input&#x2F;output, I decided to take <strong>getchar&#x2F;putchar</strong> methods and wrap it into a namespace, which has better readability. Now since we may read integers that have a wider range in real problems, so I also decided to wrap it with <strong>C++ templates</strong>, thus the user can also process data types such as <strong>long long</strong> with it, with the help of <strong>template argument deduction</strong> in C++17, you don’t need to explicitly indicate the type.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function">    <span class="keyword">inline</span></span></span><br><span class="line"><span class="function">    <span class="type">bool</span> <span class="title">can_read</span><span class="params">(T &amp;t)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> ch = <span class="built_in">getchar_unlocked</span>();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (ch == EOF) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            n |= ch == <span class="string">&#x27;-&#x27;</span>;</span><br><span class="line">            ch = <span class="built_in">getchar_unlocked</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        t = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) &#123;</span><br><span class="line">            t = t * <span class="number">10</span> + ch - <span class="number">48</span>;</span><br><span class="line">            ch = <span class="built_in">getchar_unlocked</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (n) t = -t;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span></span></span><br><span class="line"><span class="function">    <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;t)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = <span class="number">0</span>; <span class="type">int</span> c = <span class="built_in">getchar_unlocked</span>(); t = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(c)) n |= c == <span class="string">&#x27;-&#x27;</span>, c = <span class="built_in">getchar_unlocked</span>();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(c)) t = t * <span class="number">10</span> + c - <span class="number">48</span>, c = <span class="built_in">getchar_unlocked</span>();</span><br><span class="line">        <span class="keyword">if</span> (n) t = -t;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span>... Args&gt;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span></span></span><br><span class="line"><span class="function">    <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;t, Args &amp;... args)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">read</span>(t); <span class="built_in">read</span>(args...);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(T x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (x &lt; <span class="number">0</span>) x = -x, <span class="built_in">putchar_unlocked</span>(<span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (x &gt; <span class="number">9</span>) <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">        <span class="built_in">putchar_unlocked</span>(x % <span class="number">10</span> + <span class="number">48</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">writeln</span><span class="params">(T x)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">write</span>(x);</span><br><span class="line">        <span class="built_in">putchar_unlocked</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> val;</span><br><span class="line">    IO::<span class="built_in">read</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        IO::<span class="built_in">read</span>(val);</span><br><span class="line">        IO::<span class="built_in">writeln</span>(val);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="0x03-How-to-tweak-the-faster-way-of-I-O-to-handle-different-variadic-arguments-1"><a href="#0x03-How-to-tweak-the-faster-way-of-I-O-to-handle-different-variadic-arguments-1" class="headerlink" title="0x03 How to tweak the faster way of I&#x2F;O to handle different variadic arguments?"></a>0x03 How to tweak the faster way of I&#x2F;O to handle different variadic arguments?</h4><p>Since C++11 we have <strong>Parameter pack</strong> that accepts zero or more template arguments, we can simply pack variadic arguments and process them using recursion, and now we can have the full demo code with the final version of a wrapper:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/extc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="keyword">using</span> ll = <span class="type">long</span> <span class="type">long</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> IO &#123;</span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function">    <span class="keyword">inline</span></span></span><br><span class="line"><span class="function">    <span class="type">bool</span> <span class="title">can_read</span><span class="params">(T &amp;t)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> ch = <span class="built_in">getchar_unlocked</span>();</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(ch)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (ch == EOF) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            n |= ch == <span class="string">&#x27;-&#x27;</span>;</span><br><span class="line">            ch = <span class="built_in">getchar_unlocked</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        t = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(ch)) &#123;</span><br><span class="line">            t = t * <span class="number">10</span> + ch - <span class="number">48</span>;</span><br><span class="line">            ch = <span class="built_in">getchar_unlocked</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (n) t = -t;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span>... Args&gt;</span></span><br><span class="line"><span class="function">    <span class="keyword">inline</span></span></span><br><span class="line"><span class="function">    <span class="type">bool</span> <span class="title">can_read</span><span class="params">(T&amp; t, Args&amp;... args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">can_read</span>(t) &amp;&amp; <span class="built_in">can_read</span>(args...);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function">    <span class="keyword">inline</span></span></span><br><span class="line"><span class="function">    <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;t)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> n = <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> c = <span class="built_in">getchar_unlocked</span>();</span><br><span class="line">        t = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!<span class="built_in">isdigit</span>(c)) n |= c == <span class="string">&#x27;-&#x27;</span>, c = <span class="built_in">getchar_unlocked</span>();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">isdigit</span>(c)) t = t * <span class="number">10</span> + c - <span class="number">48</span>, c = <span class="built_in">getchar_unlocked</span>();</span><br><span class="line">        <span class="keyword">if</span> (n) t = -t;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span>... Args&gt;</span></span><br><span class="line"><span class="function">    <span class="keyword">inline</span></span></span><br><span class="line"><span class="function">    <span class="type">void</span> <span class="title">read</span><span class="params">(T &amp;t, Args &amp;... args)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">read</span>(t);</span><br><span class="line">        <span class="built_in">read</span>(args...);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function">    <span class="keyword">inline</span> <span class="type">void</span> <span class="title">write</span><span class="params">(T x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (x &lt; <span class="number">0</span>) x = -x, <span class="built_in">putchar_unlocked</span>(<span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (x &gt; <span class="number">9</span>) <span class="built_in">write</span>(x / <span class="number">10</span>);</span><br><span class="line">        <span class="built_in">putchar_unlocked</span>(x % <span class="number">10</span> + <span class="number">48</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T&gt;</span></span><br><span class="line"><span class="function">    <span class="keyword">inline</span> <span class="type">void</span> <span class="title">writeln</span><span class="params">(T x)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">write</span>(x);</span><br><span class="line">        <span class="built_in">putchar_unlocked</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span>... Args&gt;</span></span><br><span class="line"><span class="function">    <span class="keyword">inline</span> <span class="type">void</span> <span class="title">writeln</span><span class="params">(T t, Args... args)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">writeln</span>(t); <span class="built_in">writeln</span>(args...);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ll val;</span><br><span class="line">    <span class="keyword">while</span> (IO::<span class="built_in">can_read</span>(val)) IO::<span class="built_in">writeln</span>(val);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You can try <a target="_blank" rel="noopener" href="https://open.kattis.com/problems/sumsets">this problem</a> with and without using the fast IO method, and here are my two different time costs. You can see in this case the fast IO method hugely helps you reduce the run-time, even though the algorithm is the same.</p>
<p><img src="/attaches/fast_io.png" alt="fast_io"></p>
<h4 id="0x04-What-you-should-know-if-you-want-to-use-the-wrapper-in-a-real-competition-1"><a href="#0x04-What-you-should-know-if-you-want-to-use-the-wrapper-in-a-real-competition-1" class="headerlink" title="0x04 What you should know if you want to use the wrapper in a real competition?"></a>0x04 What you should know if you want to use the wrapper in a real competition?</h4><p>Well, for problems that only require you to read or write wrappers, you could just use it in the competition. On the other hand, if the problem requires you to process strings, you should use <strong>scanf</strong> or <strong>cin</strong> without sync and <strong>std::string</strong>. If you have to handle numbers and strings at the same, don’t use the wrapper and <strong>cin&#x2F;cout</strong> without syncing together since the sync between <strong>cin&#x2F;cout</strong> and <strong>getchar&#x2F;putchar</strong> is cancelled.</p>
<h4 id="0x05-References"><a href="#0x05-References" class="headerlink" title="0x05 References"></a>0x05 References</h4><p><a target="_blank" rel="noopener" href="https://github.com/H-Shen/Collection_of_my_coding_practice/blob/master/Miscellaneous/FastIO.cpp">Implementation of fast IO in C++</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/H-Shen/Collection_of_my_coding_practice/blob/master/Miscellaneous/FastIOTest.sh">Shellscript to run the benchmark</a></p>
</article></div></main><div class="nav-wrap"><div class="nav"><button class="site-nav"><div class="navicon"></div></button><ul class="nav_items"><li class="nav_item"><a class="nav-page" href="/about"> About</a></li><li class="nav_item"><a class="nav-page" href="/blogs"> Blogs</a></li><li class="nav_item"><a class="nav-page" href="/projects"> Projects</a></li><li class="nav_item"><a class="nav-page" href="/notes"> Notes</a></li></ul></div><div class="cd-top"><i class="fa fa-arrow-up" aria-hidden="true"></i></div></div><footer id="page_footer"><div class="footer_wrap"><div class="copyright">&copy;2023 by Haohu Shen</div><div class="theme-info">Powered by <a target="_blank" href="https://hexo.io" rel="nofollow noopener">Hexo</a> & <a target="_blank" href="https://github.com/PhosphorW/hexo-theme-academia" rel="nofollow noopener">Academia Theme</a></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery-pjax@latest/jquery.pjax.min.js"></script><script src="/js/main.js"></script></body></html>